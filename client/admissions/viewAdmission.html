<template name="ViewAdmission">
{{#if Template.subscriptionsReady}}

	<article class="recipe">
		<h2> <a href="/patient/{{patient._id}}">{{patient.fullName}}</a> {{patient.currentBed.fullName}} </h2>
		<h3> {{admission.reason }} </h3>
		{{#if editMode}} 
			{{> updateAdmissionForm var=admission }} 
		{{else}} 
		{{#if admission.eligibleForDischarge}}
			<button class="btn-deny toggleDischarge">Remove eligible for discharge</button>

			<button class="btn-deny discharge">Discharge</button> {{else}}
			<button class="btn-primary toggleDischarge">Make eligible for discharge</button> 
		{{/if}}

		{{> updateScriptForm var=admission}}

		<a href="/admitPatient/{{admission.patient}}" class="top-bar-button"> Move Patient </a>

		<a href="/editAdmission/{{admission._id}}" class="top-bar-button"> Edit  </a>

		<br/> Admission: {{admission.admissionNote}} <br/>  Admitted on: {{datef admission.created}} <br/>

		<button class="btn visit">New Visit</button> {{#each admission.visits}}
		<section>
			{{note}}
			<!-- TODO: updatedAt should be created -->
			<p> {{visitCreator}} - {{datef updatedAt}} </p>
		</section>
		{{/each}}


		<table border="1">
			<tr>
				<th>Bed</th>
				<th> From</th>
				<th> To</th>
				<th> Days</th>
				<th> Price</th>
				<th> Total</th>
			</tr>

			{{#each admission.bedStaysObj.stays}}
			<tr>
				<td>{{bed.fullName}}</td>
				<td> {{fromDatef}} </td>
				<td> {{toDatef}} </td>
				<td> {{days}} </td>
				<td> {{price}} </td>
				<td> {{total}} </td>
			</tr>
			{{/each}}
			<tr>
				<td colspan="6">
					<b> Total : {{ admission.bedStaysObj.total }}</b>
				</td>
			</tr>
		</table>

		<i class="fa fa-trash"></i>
		<i class="fa fa-pencil"></i> {{/if}}

	</article>


	{{> quickForm collection="Invoices" id="editInvoiceForm" type=formType 
		doc=currentInv autosave=true }}

		Bed Stay : Rs. <b> {{ admission.bedStaysObj.total }} </b>
		<br/>
		Grand Total : <b> Rs {{ grandTotal  }} </b>
	
{{/if}} 

</template>

<template name="updateAdmissionForm">
	{{#autoForm collection="Admissions" id="updateAdmissionForm" type="update" doc=var}}
	<fieldset>
		<legend>Update Admission</legend>
		{{> afQuickField name='reason'}}
		{{> afQuickField name='admissionNote'}}
		{{#if doc.eligibleForDischarge}}
		{{> afQuickField name='dischargeNote'}}
		{{/if}}
	</fieldset>
	<button type="submit" class="btn btn-primary">Update</button>
	 {{/autoForm}}
</template>

<template name="updateScriptForm">
	{{#autoForm collection="Admissions" id="updateAdmissionScriptForm" type="update" doc=var}}
	<fieldset>
		<legend>Update Script</legend>
		{{> afQuickField name='script'}}
	</fieldset>
	<button type="submit" class="btn btn-primary">Update</button> {{/autoForm}}
</template>