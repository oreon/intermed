<template name="Patient">

	<article class="recipe">
		<h3> {{patient.fullName}} </h3>
        <h5> 
        {{#each patient.chronicConditions}}
            {{name}}
        {{/each}} 
        </h5>
         {{#if isAdmitted}}
		<button class="btn-deny viewAdmission">Go to Admission</button>
		<button class="btn-deny visit">Visit</button> 
        {{else}}
		<button class="btn-primary admit">Admit</button>
         {{/if}}
        <br/>
        <panel>
            Social History : {{patient.socialHistory}}
         </panel> 
         <br/>
         <well>
            Medical History : {{patient.pastMedicalHistory}}
         </well>  

       

    <ul class="nav nav-tabs">
		<li class="active"><a data-toggle="tab" href="#enc">Encounters</a></li>
		<li><a data-toggle="tab" href="#drugAllergies">Drug Allergies</a></li>
		
		<li><a data-toggle="tab" href="#immunizations">Immunizations</a></li>
        <li><a data-toggle="tab" href="#ordered">Ordered Tests</a></li>
		<li><a data-toggle="tab" href="#testResults">Test Results</a></li>
		<li><a data-toggle="tab" href="#ptGraphs">Graphs</a></li>

		<li><a data-toggle="tab" href="#invoice">Invoice</a></li>
	</ul>

	<div class="tab-content">
		<div id="enc" class="tab-pane fade in active">
			{{> encountersTmpl patient=patient }} 
		</div>
        <div id="drugAllergies" class="tab-pane fade ">
            {{> drugAllergies patient=patient }}
		</div>
        <div id="immunizations" class="tab-pane fade ">
            {{> immunizationsTmpl patient=patient}}
		</div>

        <div id="ordered" class="tab-pane fade">
            {{#autoForm collection="Patients" id="updatePtTestsForm" type="update" doc=patient}}
                {{> afQuickField name='orderedLabsAndImages'}} 	
                <button type="submit" class="btn btn-primary">Update</button> 
            {{/autoForm}}
		</div>

		<div id="testResults" class="tab-pane fade">
            {{> testResults}}
		</div>

		<div id="ptGraphs" class="tab-pane fade">
			wisdom
		</div>
	</div>
		<i class="fa fa-trash"></i>
		<i class="fa fa-pencil"></i>
	</article>

</template>

<template name="encountersTmpl">
{{#if isSet  'editEncounterForm'}} 
    {{> quickForm collection="Encounters" id="newEncounterForm22" type="insert" template="plain"}} 
    <button class="btn-primary cancelEditEncounter">CancelEdit</button>
{{else}} 
    <button class="btn-primary encounter">New Encounter</button>
    <p>
    {{#each patient.encounters}} 
        {{reason}}
        {{> scriptTbl script = script}}
        <br/> 
    {{/each}}
    </p>
{{/if}}
</template>


<template name="scriptTbl">
    
    {{# if script.items}} 
    <div class="table-responsive">
	{{script.notes}} <br/>

    <table class="table">
		<tr style="background:#88a; color: #ffd">
			<th> Drug</th>
            <th> Amount</th>
			<th> Frequency</th>
            <th> Duration </th>
 			<th> Instructions </th>
            <th> End Date </th>
            <th> Units </th>
		</tr>
        {{#each script.items}}
        <tr>
            <td>{{ drugName drug }}</td>
            <td> {{amount}} </td>
            <td> {{frequency.every}} / {{frequency.type}}</td>
            <td> {{duration.for}} {{duration.type}}(s)</td>
            <td> {{instructions}}</td>
            <td> {{ endDate . }}</td>
            <td> {{unitsNeeded . }}</td>
        </tr>
        {{/each}} 
       
	</table>
    </div>

    {{#each script.items}}
    {{ drugName drug }}
    {{#with item}}  
    <ul>
    {{#each calcSchedule .}}
    <li> {{ drugName item.drug }} {{.}} </li>    
    {{/each}} 
    </ul>
    {{/with}}
    {{/each}}

     {{/if}}
</template>

<template name="drugAllergies">
    {{#if patient.drugAllergies}} 
        <table class="table table-striped table-bordered table-condensed">
            <tr style="background:#88a; color: #ffd">
                <th>Drug</th>
                <th> Allergy Serverity</th>
            </tr>
            {{#each patient.drugAllergies}}
            <tr>
                <td>{{drugName  drug }}</td>
                <td> {{severity}} </td>
                <td> <button class="btn btn-deny deleteAllergy" name='{{drug}}' > Delete </button> </td>
            </tr>
            {{/each}} 
        </table>
    {{else}}
        No Allergies recorded.
    {{/if}}

    {{> quickForm id="insertDrugAllergyForm" type="update-pushArray" collection="Patients" 
      doc=patient scope="drugAllergies"}}
</template>

<template name="immunizationsTmpl">
    {{#if patient.immunizations}} 
        <table class="table table-striped table-bordered table-condensed">
            <tr style="background:#88a; color: #ffd">
                <th>Vaccine</th>
                <th> Date</th>
            </tr>
            {{#each patient.immunizations}}
            <tr>
                <td>{{vaccine}}</td>
                <td> {{datef updatedAt}} </td>
                <td> <button class="btn btn-deny deleteVaccine" name='{{vaccine}}' > Delete </button> </td>
            </tr>
            {{/each}} 
        </table>
    {{else}}
        No Immunizations recorded.
    {{/if}}

    {{> quickForm id="insertImmunizationForm" type="update-pushArray" collection="Patients" 
      doc=patient scope="immunizations"}}
</template>

<template name="basicWizard">
  {{> wizard id="basic-wizard" steps=steps}}
</template>