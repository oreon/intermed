<template name="Patient">

	<article class="recipe">
		 {{> patInfo patient=patient}}
         {{#if isAdmitted}}
		<button class="btn-deny viewAdmission">Go to Admission</button>
		<button class="btn-deny visit">Visit</button> 
        {{else}}
		<button class="btn-primary admit">Admit</button>
         {{/if}}
        <br/>
        
	<button class="btn btn-primary" 
				data-toggle="collapse" data-target="#morePtInfo">More Info</button>

	<div class="collapse" id="morePtInfo">
	
        <div class="panel panel-primary">
            <div class="panel-heading">Social History</div>
            <div class="panel-body">{{patient.socialHistory}}</div>
        </div>
             
        <div class="panel panel-primary">
            <div class="panel-heading">Medical History</div>
            <div class="panel-body">{{patient.pastMedicalHistory}}</div>
        </div>
	</div>    
        
       
    <ul class="nav nav-tabs">
		<li class="active"><a data-toggle="tab" href="#enc">Encounters</a></li>
		<li><a data-toggle="tab" href="#drugAllergies">Drug Allergies</a></li>
		
		<li><a data-toggle="tab" href="#immunizations">Immunizations</a></li>
        <li><a data-toggle="tab" href="#ordered">Ordered Tests</a></li>
		<li><a data-toggle="tab" href="#testResults">Test Results</a></li>
		<li><a data-toggle="tab" href="#ptGraphs">Graphs</a></li>

		<li><a data-toggle="tab" href="#docs">Documents</a></li>
	</ul>

	<div class="tab-content">
		<div id="enc" class="tab-pane fade in active">
			{{> encountersTmpl patient=patient }} 
		</div>
        <div id="drugAllergies" class="tab-pane fade ">
            {{> drugAllergies patient=patient }}
		</div>
        <div id="immunizations" class="tab-pane fade ">
            {{> immunizationsTmpl patient=patient}}
		</div>

        <div id="ordered" class="tab-pane fade">
            {{#autoForm collection="Patients" id="updatePtTestsForm" type="update" doc=patient}}
                {{> afQuickField name='orderedLabsAndImages'}} 	
                <button type="submit" class="btn btn-primary">Update</button> 
            {{/autoForm}}
		</div>

		<div id="testResults" class="tab-pane fade">
            {{> testResults}}
		</div>

		<div id="ptGraphs" class="tab-pane fade">
			wisdom
		</div>

        <div id="docs" class="tab-pane fade">
            {{> imageUploader}}
        </div>
	</div>
		<i class="fa fa-trash"></i>
		<a href="/editPatient/{{patient._id}}"><i class="fa fa-pencil"></i></a>
	</article>

</template>

<template name="encountersTmpl">

{{#if isSet  'editEncounterForm'}} 
    {{> quickForm collection="Encounters" id="newEncounterForm22" type="insert" template="plain"}} 
    <button class="btn-primary cancelEditEncounter">CancelEdit</button>
{{else}} 
    <button class="btn-primary encounter">New Encounter</button>
    <p>
    {{#each patient.encounters}} 
    <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">{{createdBy}} {{createdAt}}</div>
            <div class="panel-body">
                {{reason}}
                {{> scriptTbl script = script}}
             </div>
        </div>
        
    </div>
    {{/each}}
    </p>
{{/if}}
</template>


<template name="scriptTbl">
    
    {{# if script.items}} 
  
    <h5> {{script.notes}} </h5> <br/>

    <table class="table table-striped table-condensed">
        <thead>
		<tr style="background:#88a; color: #ffd">
			<th> Drug</th>
            <th> Start Date </th> 
            <th> End Date </th>
            <th> Units </th>
            <th> Instructions </th>
		</tr>
        </thead>
        <tbody>
        {{#each enhItems (script) }}
        <tr style = "{{rowColorOutdated}}" >
            <td>{{ drugName drug }} {{amount}} {{route}}
             {{frequency.every}} / {{frequency.type}} 
            {{duration.for}} {{duration.type}}(s)
            </td>
            <td> {{datef startDate }}</td>
            <td> {{datef endDate }}</td>
            <td> {{unitsNeeded }}</td>
            <td> {{instructions}}</td>
        </tr>
        {{/each}} 
        </tbody>
	</table>
    
     {{/if}}
</template>

<template name="recurringMsmtTmpl">
    {{admission.reason}}
   <table class="table">
       <thead>
		<tr style="background:#88a; color: #ffd">
			<th> Measurement</th>
     		<th> Frequency</th>
        	<th> Instructions </th>
            <th> Start Date </th> 
     	</tr>
       </thead>
         <tbody>
        {{#each recurringAssessments }}
        <tr>
            <td>{{ name }}</td>
            <td> {{frequency.every}} / {{frequency.type}}</td>
            <td> {{instructions}}</td>
            <td> {{datef startDate }}</td>
        </tr>
        {{/each}} 
         </tbody>
	</table>
</template>

<template name="drugAllergies">
    {{#if patient.drugAllergies}} 
        <table class="table table-striped table-bordered table-condensed">
            <tr style="background:#88a; color: #ffd">
                <th>Drug</th>
                <th> Allergy Serverity</th>
            </tr>
            {{#each patient.drugAllergies}}
            <tr>
                <td>{{drugName  drug }}</td>
                <td> {{severity}} </td>
                <td> <button class="btn btn-deny deleteAllergy" name='{{drug}}' > Delete </button> </td>
            </tr>
            {{/each}} 
        </table>
    {{else}}
        No Allergies recorded.
    {{/if}}

    {{> quickForm id="insertDrugAllergyForm" type="update-pushArray" collection="Patients" 
      doc=patient scope="drugAllergies"}}
</template>

<template name="immunizationsTmpl">
    {{#if patient.immunizations}} 
        <table class="table table-striped table-bordered table-condensed">
            <tr style="background:#88a; color: #ffd">
                <th>Vaccine</th>
                <th> Date</th>
            </tr>
            {{#each patient.immunizations}}
            <tr>
                <td>{{vaccine}}</td>
                <td> {{datef updatedAt}} </td>
                <td> <button class="btn btn-deny deleteVaccine" name='{{vaccine}}' > Delete </button> </td>
            </tr>
            {{/each}} 
        </table>
    {{else}}
        No Immunizations recorded.
    {{/if}}

    {{> quickForm id="insertImmunizationForm" type="update-pushArray" collection="Patients" 
      doc=patient scope="immunizations"}}
</template>

<template name="basicWizard">
  {{> wizard id="basic-wizard" steps=steps}}
</template>


<template name="imageView">
  <div class="imageView">
    {{#each images}}
      <div>
        <a href="{{this.url}}" target="_blank"><img src="{{this.url store='thumbs' uploading='/images/uploading.gif' storing='/images/storing.gif'}}" alt="" class="thumbnail" /></a>
      </div>
    {{/each}}
  </div>
</template>


<template name="patInfo">
    <a href="/patient/{{patient._id}}">{{patient.fullName}}</a> {{extra}}
        <h5> 
        {{#if patient.pregnant}} Pregnant {{/if}}
        {{#each patient.chronicConditions}}
            {{.}}
        {{/each}} 
        </h5>
</template>


